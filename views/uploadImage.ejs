<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File uploading</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.form/3.51/jquery.form.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <style>
        .navbar {
            position: relative;
            min-height: 50px;
            border: 1px solid transparent;
        }
    </style>

    <script>
        $(document).ready(function () {
            var anotherClicked = false;
            $('#file').on('click', () => {
                anotherClicked = true;
            })
            // adjust the form submit button action to send a post route to the submit url 
            $('#uploadForm').submit(function () {
                if ($('#file').val() != "" && anotherClicked == true) {
                    $("#status").empty().text("Please wait ... as the image file being uploading .....");
                    $(this).ajaxSubmit({
                        success: function (response) {
                            $("#status").empty().text(response);
                        },
                        error: function (err) {
                            $("#status").empty().text('Uploading Error : ' + err.status);
                        },
                    });
                    anotherClicked = false;
                } else if ($('#file').val() != "" && anotherClicked == false) {
                    $("#status").empty();
                    alert('This image was already uploaded before !');
                } else {
                    $("#status").empty();
                    alert('Sorry, please select any image file to be uploaded !');
                }
                return false;
            });
        });  
    </script>

</head>

<body>
    <%- include('./header') %>
    <br>
    <br>
    <h1>Welcome <%= user.username %> in your profile</h1>
    <h2 style="color: red;"> You can upload an image right now, just choose one and upload it. </h2>
    <br>
    <form id="uploadForm" action="/images/uploadImage" method="post">
        <div class="form-group">
            <input class="btn btn-primary" type="file" name="fileFormField" id="file" accept="image/*">
        </div>
        <div class="form-group">
            <button class="btn btn-primary" type="submit" name="submit">Upload image</button>
            <button type="reset" class="btn btn-danger">Reset</button>
        </div>
        <div class="form-group">
            <label> Uploading status: </label> <span id="status"></span>
        </div>

    </form>


</body>

</html>